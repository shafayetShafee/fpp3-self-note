{
  "hash": "fbdc959084cf0f090dcddc8702d7b6ab",
  "result": {
    "engine": "knitr",
    "markdown": "## Time Series Graphics\n\n## tsibble objects\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(fpp3)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nolympic_running\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 312 x 4 [4Y]\n# Key:       Length, Sex [14]\n    Year Length Sex    Time\n   <int>  <int> <chr> <dbl>\n 1  1896    100 men    12  \n 2  1900    100 men    11  \n 3  1904    100 men    11  \n 4  1908    100 men    10.8\n 5  1912    100 men    10.8\n 6  1916    100 men    NA  \n 7  1920    100 men    10.8\n 8  1924    100 men    10.6\n 9  1928    100 men    10.8\n10  1932    100 men    10.3\n# ℹ 302 more rows\n```\n\n\n:::\n:::\n\n\n- `[4Y]` => Its a every four year data\n- There are 14 time series based on the `Length` and `Sex` variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPBS\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 67,596 x 9 [1M]\n# Key:       Concession, Type, ATC1, ATC2 [336]\n      Month Concession   Type      ATC1  ATC1_desc ATC2  ATC2_desc Scripts  Cost\n      <mth> <chr>        <chr>     <chr> <chr>     <chr> <chr>       <dbl> <dbl>\n 1 1991 Jul Concessional Co-payme… A     Alimenta… A01   STOMATOL…   18228 67877\n 2 1991 Aug Concessional Co-payme… A     Alimenta… A01   STOMATOL…   15327 57011\n 3 1991 Sep Concessional Co-payme… A     Alimenta… A01   STOMATOL…   14775 55020\n 4 1991 Oct Concessional Co-payme… A     Alimenta… A01   STOMATOL…   15380 57222\n 5 1991 Nov Concessional Co-payme… A     Alimenta… A01   STOMATOL…   14371 52120\n 6 1991 Dec Concessional Co-payme… A     Alimenta… A01   STOMATOL…   15028 54299\n 7 1992 Jan Concessional Co-payme… A     Alimenta… A01   STOMATOL…   11040 39753\n 8 1992 Feb Concessional Co-payme… A     Alimenta… A01   STOMATOL…   15165 54405\n 9 1992 Mar Concessional Co-payme… A     Alimenta… A01   STOMATOL…   16898 61108\n10 1992 Apr Concessional Co-payme… A     Alimenta… A01   STOMATOL…   18141 65356\n# ℹ 67,586 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nPBS %>% \n  filter(ATC2 == 'A10') %>% \n  select(Month, Concession, Type, Cost)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 816 x 4 [1M]\n# Key:       Concession, Type [4]\n      Month Concession   Type           Cost\n      <mth> <chr>        <chr>         <dbl>\n 1 1991 Jul Concessional Co-payments 2092878\n 2 1991 Aug Concessional Co-payments 1795733\n 3 1991 Sep Concessional Co-payments 1777231\n 4 1991 Oct Concessional Co-payments 1848507\n 5 1991 Nov Concessional Co-payments 1686458\n 6 1991 Dec Concessional Co-payments 1843079\n 7 1992 Jan Concessional Co-payments 1564702\n 8 1992 Feb Concessional Co-payments 1732508\n 9 1992 Mar Concessional Co-payments 2046102\n10 1992 Apr Concessional Co-payments 2225977\n# ℹ 806 more rows\n```\n\n\n:::\n:::\n\n\n> Note that the index variable `Month`, and the keys `Concession` and `Type`, would be returned even if they were not explicitly selected as they are required for a tsibble (to ensure each row contains a unique combination of keys and index).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nPBS %>% \n  filter(ATC2 == 'A10') %>% \n  select(Month, Concession, Type, Cost) %>% \n  summarize(total = sum(Cost))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 204 x 2 [1M]\n      Month   total\n      <mth>   <dbl>\n 1 1991 Jul 3526591\n 2 1991 Aug 3180891\n 3 1991 Sep 3252221\n 4 1991 Oct 3611003\n 5 1991 Nov 3565869\n 6 1991 Dec 4306371\n 7 1992 Jan 5088335\n 8 1992 Feb 2814520\n 9 1992 Mar 2985811\n10 1992 Apr 3204780\n# ℹ 194 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nPBS %>% \n  filter(ATC2 == 'A10') %>% \n  select(Month, Concession, Type, Cost) %>% \n  summarize(total = sum(Cost)) %>% \n  mutate(Cost = total / 1e6) -> a10\n```\n:::\n\n\n\n### Read a csv file and convert it to a tsibble \n\n\n::: {.cell}\n\n```{.r .cell-code}\nprison <- readr::read_csv(\"https://OTexts.com/fpp3/extrafiles/prison_population.csv\")\nhead(prison)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  Date       State Gender Legal     Indigenous Count\n  <date>     <chr> <chr>  <chr>     <chr>      <dbl>\n1 2005-03-01 ACT   Female Remanded  ATSI           0\n2 2005-03-01 ACT   Female Remanded  Non-ATSI       2\n3 2005-03-01 ACT   Female Sentenced ATSI           0\n4 2005-03-01 ACT   Female Sentenced Non-ATSI       5\n5 2005-03-01 ACT   Male   Remanded  ATSI           7\n6 2005-03-01 ACT   Male   Remanded  Non-ATSI      58\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(prison$Date)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"2005-03-01\" \"2005-06-01\" \"2005-09-01\" \"2005-12-01\" \"2006-03-01\"\n [6] \"2006-06-01\" \"2006-09-01\" \"2006-12-01\" \"2007-03-01\" \"2007-06-01\"\n[11] \"2007-09-01\" \"2007-12-01\" \"2008-03-01\" \"2008-06-01\" \"2008-09-01\"\n[16] \"2008-12-01\" \"2009-03-01\" \"2009-06-01\" \"2009-09-01\" \"2009-12-01\"\n[21] \"2010-03-01\" \"2010-06-01\" \"2010-09-01\" \"2010-12-01\" \"2011-03-01\"\n[26] \"2011-06-01\" \"2011-09-01\" \"2011-12-01\" \"2012-03-01\" \"2012-06-01\"\n[31] \"2012-09-01\" \"2012-12-01\" \"2013-03-01\" \"2013-06-01\" \"2013-09-01\"\n[36] \"2013-12-01\" \"2014-03-01\" \"2014-06-01\" \"2014-09-01\" \"2014-12-01\"\n[41] \"2015-03-01\" \"2015-06-01\" \"2015-09-01\" \"2015-12-01\" \"2016-03-01\"\n[46] \"2016-06-01\" \"2016-09-01\" \"2016-12-01\"\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprison %>% \n  mutate(Quarter = yearquarter(Date)) %>% \n  select(-Date) %>% \n  as_tsibble(\n    key = c(State, Gender, Legal, Indigenous),\n    index = Quarter\n  ) -> prison\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprison\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 3,072 x 6 [1Q]\n# Key:       State, Gender, Legal, Indigenous [64]\n   State Gender Legal    Indigenous Count Quarter\n   <chr> <chr>  <chr>    <chr>      <dbl>   <qtr>\n 1 ACT   Female Remanded ATSI           0 2005 Q1\n 2 ACT   Female Remanded ATSI           1 2005 Q2\n 3 ACT   Female Remanded ATSI           0 2005 Q3\n 4 ACT   Female Remanded ATSI           0 2005 Q4\n 5 ACT   Female Remanded ATSI           1 2006 Q1\n 6 ACT   Female Remanded ATSI           1 2006 Q2\n 7 ACT   Female Remanded ATSI           1 2006 Q3\n 8 ACT   Female Remanded ATSI           0 2006 Q4\n 9 ACT   Female Remanded ATSI           0 2007 Q1\n10 ACT   Female Remanded ATSI           1 2007 Q2\n# ℹ 3,062 more rows\n```\n\n\n:::\n:::\n\n\n### The seasonal period\n\n> Seasonal period: Number of observations before the seasonal pattern repeats. For quarterly, monthly, weekly data, the seasonal period is the number of obs in a year.\n\n> If the data is observed more than once per week, then there is often more than one seasonal pattern in the data. For example, data with daily observations might have weekly (period = 7) or annual (period = 365) seasonal patterns. Similarly, data that are observed every minute might have hourly (period = 60), daily (period = 24 x 60 = 1440), weekly (period = 7 x 24 x 60) and annual seasonality (period = 365 x 24 x 60).\n\n\n## Time plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\na10 %>% \n  autoplot(Cost) +\n  labs(\n    y = \"$ (Millions)\",\n    title = \"Australian anitdiabetic drug sales\"\n  )\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Seasonal plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\na10 %>% \n  gg_season(Cost, labels = \"both\")\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n### Multiple Seasonal Periods\n\n> Where the data has more than one seasonal pattern, the period argument can be used to select which seasonal plot is required.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec %>% \n  gg_season(Demand, period = \"day\") \n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nvic_elec %>% \n  gg_season(Demand, period = \"week\")\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Seasonal subseries plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\na10 %>% \n  gg_subseries(Cost)\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 24,320 x 5 [1Q]\n# Key:       Region, State, Purpose [304]\n   Quarter Region   State           Purpose  Trips\n     <qtr> <chr>    <chr>           <chr>    <dbl>\n 1 1998 Q1 Adelaide South Australia Business  135.\n 2 1998 Q2 Adelaide South Australia Business  110.\n 3 1998 Q3 Adelaide South Australia Business  166.\n 4 1998 Q4 Adelaide South Australia Business  127.\n 5 1999 Q1 Adelaide South Australia Business  137.\n 6 1999 Q2 Adelaide South Australia Business  200.\n 7 1999 Q3 Adelaide South Australia Business  169.\n 8 1999 Q4 Adelaide South Australia Business  134.\n 9 2000 Q1 Adelaide South Australia Business  154.\n10 2000 Q2 Adelaide South Australia Business  169.\n# ℹ 24,310 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  filter(Purpose == 'Holiday') %>% \n  group_by(State) %>% \n  summarize(Trips = sum(Trips)) -> holidays\n\nholidays\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 640 x 3 [1Q]\n# Key:       State [8]\n   State Quarter Trips\n   <chr>   <qtr> <dbl>\n 1 ACT   1998 Q1  196.\n 2 ACT   1998 Q2  127.\n 3 ACT   1998 Q3  111.\n 4 ACT   1998 Q4  170.\n 5 ACT   1999 Q1  108.\n 6 ACT   1999 Q2  125.\n 7 ACT   1999 Q3  178.\n 8 ACT   1999 Q4  218.\n 9 ACT   2000 Q1  158.\n10 ACT   2000 Q2  155.\n# ℹ 630 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays %>% autoplot(Trips)\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays %>% \n  gg_season(Trips)\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nholidays %>% \n  gg_subseries(Trips)\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n## Measuring Correlation Coefficient\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntourism %>% \n  group_by(State) %>% \n  summarise(Trips = sum(Trips)) %>% \n  pivot_wider(names_from = State, values_from = Trips) %>% \n  GGally::ggpairs(columns = 2:9)\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n\n\n## Lagged plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production %>% \n  filter(year(Quarter) >= 2000) %>% \n  autoplot(Beer)\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naus_production %>% \n  filter(year(Quarter) >= 2000) -> recent_production\n  \nrecent_production %>% gg_lag(Beer, geom = \"point\")\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n- Positive correlation at lag 4 and 8 => presence of strong seasonality.\n\n\n## Autocorrelation\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrecent_production %>% ACF(y = Beer, lag_max = 9)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 9 x 2 [1Q]\n       lag      acf\n  <cf_lag>    <dbl>\n1       1Q -0.0530 \n2       2Q -0.758  \n3       3Q -0.0262 \n4       4Q  0.802  \n5       5Q -0.0775 \n6       6Q -0.657  \n7       7Q  0.00119\n8       8Q  0.707  \n9       9Q -0.0888 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrecent_production %>% \n  ACF(Beer) %>% \n  autoplot()\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n> So the ACF of a trended time series tends to have positive values that slowly decrease as the lags increase.\n\n> When data are seasonal, the autocorrelations will be larger for the seasonal lags (at multiples of the seasonal period) than for other lags\n\n\n::: {.cell}\n\n```{.r .cell-code}\na10 %>% \n  ACF(Cost, lag_max = 48) %>% \n  autoplot() +\n  labs(\n    title = \"Trended and Seasonal\"\n  )\n```\n\n::: {.cell-output-display}\n![](ch2_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n\n**White Noise**: Time series that show no autocorrelation is called white noise.",
    "supporting": [
      "ch2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}